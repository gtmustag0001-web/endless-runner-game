<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Endless Runner</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  overflow:hidden;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  font-family:Arial,Helvetica,sans-serif;
  touch-action:none;
  height:100vh;
}
#gameCanvas{
  display:block;
  width:100vw;
  height:100vh;
  background:linear-gradient(to bottom,#87CEEB 0%,#98D8E8 50%,#E0F6FF 100%);
}
#ui{
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  pointer-events:none;z-index:10;
}
#score{
  position:absolute;top:20px;left:20px;
  font-size:20px;font-weight:bold;color:#fff;
  text-shadow:2px 2px 4px rgba(0,0,0,0.8);
  background:rgba(0,0,0,0.3);
  padding:8px 12px;border-radius:12px;
}
#gameOver{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:rgba(0,0,0,0.95);color:#fff;
  padding:30px;border-radius:20px;
  text-align:center;pointer-events:all;
  max-width:90vw;display:none;
}
#gameOver h2{font-size:26px;margin-bottom:10px;color:#ff6b6b}
#gameOver div{font-size:18px;margin:10px 0;color:#ffd93d}
button{
  display:block;margin:10px auto;padding:10px 20px;
  font-size:16px;border:none;border-radius:25px;
  background:linear-gradient(45deg,#ff6b6b,#ffd93d);
  color:#fff;font-weight:bold;cursor:pointer;
}
button:active{transform:scale(.97)}
#adModal{
  display:none;
  position:fixed;left:0;top:0;width:100%;height:100%;
  background:rgba(0,0,0,0.9);
  z-index:999;
  align-items:center;
  justify-content:center;
}
#adBox{
  width:90%;max-width:400px;
  background:#111;padding:20px;
  border-radius:18px;
  text-align:center;
  color:#fff;
}
#adTitle{font-size:20px;margin-bottom:10px}
#adNote{font-size:14px;color:#ccc;margin-bottom:10px}
</style>
</head>
<body>

<audio id="bgMusic" loop></audio>

<canvas id="gameCanvas"></canvas>

<div id="ui">
  <div id="score">Score: 0 | Lives: 3</div>
  <div id="gameOver">
    <h2>Game Over!</h2>
    <div>Final Score: <span id="finalScore">0</span></div>
    <button id="restartBtn">Restart</button>
    <button id="rewardBtn">Watch Ad (+3 Lives)</button>
  </div>
</div>

<div id="adModal">
  <div id="adBox">
    <div id="adTitle">Playing reward audio…</div>
    <div id="adNote">Listen till the end to get +3 lives</div>
    <audio id="adAudio"></audio>
  </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// ==== GAME STATE ====
let gameState = {
  score:0,
  lives:3,
  gameSpeed:4,
  gameRunning:true,
  groundOffset:0
};

const player = {
  x:80,
  y:0,
  width:45,
  height:60,   // taller player
  vy:0,
  gravity:2000,      // pixels/s²
  jumpPower:-900,    // pixels/s
  grounded:false,
  baseY:0
};

let obstacles = [],
    coins = [],
    particles = [],
    spawnTimer = 0;

// 2X score power-up
let doubleScoreActive = false;
let doubleScoreEndTime = 0;
let scoreMultiplier = 1;

// animation + input
let runPhase = 0;
let keyLeft = false;
let keyRight = false;
let keyJump = false;
let touchStartX = 0, touchStartY = 0, touchEndX = 0, touchEndY = 0;

/* background music: jaat.mp3 */
const bgMusic = document.getElementById("bgMusic");
const bgFile  = "jaat.mp3";
let bgStarted = false;

// ==== INPUT: TOUCH / MOUSE (MOBILE + PC) ====
canvas.addEventListener("touchstart", function (e) {
  e.preventDefault();
  if (!bgStarted) {
    bgMusic.src = bgFile;
    bgMusic.play();
    bgStarted = true;
  }
  const t = e.changedTouches[0];
  touchStartX = t.clientX;
  touchStartY = t.clientY;
});
canvas.addEventListener("touchend", function (e) {
  e.preventDefault();
  const t = e.changedTouches[0];
  touchEndX = t.clientX;
  touchEndY = t.clientY;

  const dx = touchEndX - touchStartX;
  const dy = touchEndY - touchStartY;
  const dist = Math.hypot(dx, dy);
  const minSwipe = 30;

  if (dist < minSwipe) {
    // tap = jump
    keyJump = true;
  } else {
    // swipe up = jump
    const angle = Math.atan2(-dy, dx);
    const deg = angle * 180 / Math.PI;
    if (deg > 45 && deg < 135) keyJump = true;
  }
});

canvas.addEventListener("mousedown", function () {
  if (!bgStarted) {
    bgMusic.src = bgFile;
    bgMusic.play();
    bgStarted = true;
  }
  keyJump = true;
});

// ==== INPUT: KEYBOARD (PC) ====
window.addEventListener("keydown", (e) => {
  if (["ArrowLeft","ArrowRight","ArrowUp","Space"," "].includes(e.code) ||
      ["ArrowLeft","ArrowRight","ArrowUp","Space"," "].includes(e.key)) {
    e.preventDefault();          // space / arrows se scroll na ho [web:69]
  }
  if (e.code === "ArrowLeft")  keyLeft  = true;
  if (e.code === "ArrowRight") keyRight = true;
  if (e.code === "ArrowUp" || e.code === "Space") keyJump = true;
});
window.addEventListener("keyup", (e) => {
  if (e.code === "ArrowLeft")  keyLeft  = false;
  if (e.code === "ArrowRight") keyRight = false;
  if (e.code === "ArrowUp" || e.code === "Space") keyJump = false;
});

// ==== FX PARTICLES ====
function createParticles(x,y){
  for(let i=0;i<8;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*8,
      vy:(Math.random()-0.5)*8,
      life:30,
      maxLife:30
    });
  }
}
function updateParticles(){
  for(let i=particles.length-1;i>=0;i--){
    let p=particles[i];
    p.x+=p.vx;
    p.y+=p.vy;
    p.vy+=0.2;
    p.life--;
    if(p.life<=0)particles.splice(i,1);
  }
}
function drawParticles(){
  particles.forEach(p=>{
    ctx.save();
    ctx.globalAlpha=p.life/p.maxLife;
    ctx.fillStyle="#ffd700";
    ctx.beginPath();
    ctx.arc(p.x,p.y,4,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  });
}

// ==== MAIN LOOP ====
let lastTime = performance.now();
function gameLoop(now = performance.now()){
  const delta = (now - lastTime) / 1000; // seconds
  lastTime = now;

  update(delta);
  draw();
  requestAnimationFrame(gameLoop);
}

function update(delta){
  if(!gameState.gameRunning)return;

  runPhase += delta * 10;

  // jump (PC + mobile)
  if (keyJump && player.grounded) {
    player.vy = player.jumpPower;
    player.grounded = false;
  }
  keyJump = false; // one-press one-jump

  // gravity
  player.vy += player.gravity * delta;
  player.y  += player.vy * delta;

  player.baseY = canvas.height - 160;
  if(player.y >= player.baseY - player.height){
    player.y = player.baseY - player.height;
    player.vy = 0;
    player.grounded = true;
  }

  // spawn
  spawnTimer++;
  let spawnRate = Math.max(60,120 - gameState.gameSpeed*8);
  if(spawnTimer > spawnRate){
    obstacles.push({
      x:canvas.width + 50,
      y:player.baseY - 60,
      width:35 + Math.random()*25,
      height:60
    });

    if(Math.random() > 0.3){
      const isDoubleCoin = Math.random() < 0.25;
      coins.push({
        x:canvas.width + 50,
        y:player.baseY - 150 - Math.random()*120,
        width:22,
        height:22,
        rotation:0,
        type:isDoubleCoin ? "double" : "normal"
      });
    }
    spawnTimer = 0;
  }

  // obstacles
  for(let i=obstacles.length-1;i>=0;i--){
    let o = obstacles[i];
    o.x -= gameState.gameSpeed;
    if(o.x + o.width < 0){
      obstacles.splice(i,1);
      continue;
    }
    if(o.x < player.x + player.width &&
       o.x + o.width > player.x &&
       o.y < player.y + player.height &&
       o.y + o.height > player.y){
      gameState.lives--;
      obstacles.splice(i,1);
      if(gameState.lives <= 0){
        gameOver();
        return;
      }
    }
  }

  // coins + 2X
  for(let i=coins.length-1;i>=0;i--){
    let c = coins[i];
    c.x -= gameState.gameSpeed;
    c.rotation += 0.2;
    if(c.x + c.width < 0){
      coins.splice(i,1);
      continue;
    }
    if(c.x < player.x + player.width &&
       c.x + c.width > player.x &&
       c.y < player.y + player.height &&
       c.y + c.height > player.y){

      if(c.type === "double"){
        doubleScoreActive = true;
        scoreMultiplier = 2;
        doubleScoreEndTime = performance.now() + 22000;
      }else{
        gameState.score += 15 * scoreMultiplier;
      }

      createParticles(c.x + c.width/2, c.y + c.height/2);
      coins.splice(i,1);
    }
  }

  // 2X timer
  if(doubleScoreActive && performance.now() > doubleScoreEndTime){
    doubleScoreActive = false;
    scoreMultiplier = 1;
  }

  gameState.score += 0.15 * scoreMultiplier;

  gameState.gameSpeed += 0.0008;
  gameState.groundOffset -= gameState.gameSpeed;

  updateParticles();

  let label = "Score: " + Math.floor(gameState.score);
  if(doubleScoreActive) label += " (2X)";
  document.getElementById("score").textContent =
    label + " | Lives: " + gameState.lives;
}

// ==== DRAW ====
function draw(){
  // sky
  let g = ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,"#87CEEB");
  g.addColorStop(0.5,"#98D8E8");
  g.addColorStop(1,"#E0F6FF");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // clouds
  ctx.fillStyle="rgba(255,255,255,0.8)";
  for(let i=0;i<5;i++){
    let cx=(gameState.groundOffset*0.3+i*200)%(canvas.width+200)-200;
    ctx.beginPath();
    ctx.arc(cx+40,80+i*30,25,0,Math.PI*2);
    ctx.arc(cx+70,80+i*30,35,0,Math.PI*2);
    ctx.arc(cx+100,80+i*30,25,0,Math.PI*2);
    ctx.fill();
  }

  // continuous ground
  const groundHeight = 80;
  ctx.fillStyle = "#8B4513";
  ctx.fillRect(0, player.baseY, canvas.width, groundHeight);

  ctx.fillStyle="#A0522D";
  for(let i=0;i<canvas.width;i+=40){
    ctx.fillRect(i, player.baseY+10, 30, 12);
  }

  // === PLAYER (Vector-style suit) ===
  const cxP = player.x + player.width/2;
  const cyP = player.y + player.height/2;
  const bodyHeight = 55;
  const headRadius = 11;

  // shadow
  ctx.fillStyle = "rgba(0,0,0,0.25)";
  ctx.beginPath();
  ctx.ellipse(cxP, player.baseY + 8, 18, 6, 0, 0, Math.PI*2);
  ctx.fill();

  // jacket
  ctx.fillStyle = "#111111";
  ctx.fillRect(cxP - 11, cyP - bodyHeight/4, 22, bodyHeight/2);

  // shirt
  ctx.fillStyle = "#ffffff";
  ctx.fillRect(cxP - 6, cyP - bodyHeight/4 + 2, 12, bodyHeight/2 - 4);

  // tie
  ctx.fillStyle = "#222222";
  ctx.beginPath();
  ctx.moveTo(cxP, cyP - bodyHeight/4 + 4);
  ctx.lineTo(cxP - 3, cyP - bodyHeight/4 + 14);
  ctx.lineTo(cxP + 3, cyP - bodyHeight/4 + 14);
  ctx.closePath();
  ctx.fill();
  ctx.fillRect(cxP - 2, cyP - bodyHeight/4 + 14, 4, 10);

  // arms
  ctx.strokeStyle = "#111111";
  ctx.lineWidth = 5;
  ctx.beginPath();
  ctx.moveTo(cxP - 10, cyP - bodyHeight/4 + 4);
  ctx.lineTo(cxP - 24, cyP - 2);
  ctx.moveTo(cxP + 10, cyP - bodyHeight/4 + 4);
  ctx.lineTo(cxP + 24, cyP - 8);
  ctx.stroke();

  // legs
  const legOffset = Math.sin(runPhase) * 7;
  ctx.beginPath();
  ctx.moveTo(cxP, cyP + bodyHeight/4);
  ctx.lineTo(cxP - 10, cyP + bodyHeight/2 + legOffset);
  ctx.moveTo(cxP, cyP + bodyHeight/4);
  ctx.lineTo(cxP + 10, cyP + bodyHeight/2 - legOffset);
  ctx.stroke();

  // shoes
  ctx.fillStyle = "#000000";
  ctx.fillRect(cxP - 14, cyP + bodyHeight/2 + legOffset - 2, 8, 4);
  ctx.fillRect(cxP + 6,  cyP + bodyHeight/2 - legOffset - 2, 8, 4);

  // head + neck
  ctx.fillStyle = "#f2c09b";
  ctx.beginPath();
  ctx.arc(cxP, cyP - bodyHeight/2, headRadius, 0, Math.PI*2);
  ctx.fill();
  ctx.strokeStyle = "#000000";
  ctx.lineWidth = 2;
  ctx.stroke();

  ctx.fillRect(cxP - 3, cyP - bodyHeight/2 + headRadius - 2, 6, 5);

  // coins
  coins.forEach(c=>{
    ctx.save();
    ctx.translate(c.x+c.width/2,c.y+c.height/2);
    ctx.rotate(c.rotation);
    ctx.shadowColor="#ffd700";
    ctx.shadowBlur=12;

    if(c.type === "double"){
      ctx.fillStyle="#00e5ff";
    }else{
      ctx.fillStyle="#FFD700";
    }

    ctx.beginPath();
    ctx.arc(0,0,c.width/2,0,Math.PI*2);
    ctx.fill();
    ctx.shadowBlur=0;
    ctx.strokeStyle= c.type === "double" ? "#00bcd4" : "#FFA500";
    ctx.lineWidth=3;
    ctx.stroke();

    if(c.type === "double"){
      ctx.fillStyle="#003b46";
      ctx.font="bold 10px Arial";
      ctx.textAlign="center";
      ctx.textBaseline="middle";
      ctx.fillText("2X",0,0);
    }

    ctx.restore();
  });

  // obstacles
  ctx.shadowColor="#DC143C";
  ctx.shadowBlur=10;
  ctx.fillStyle="#DC143C";
  obstacles.forEach(o=>{
    ctx.fillRect(o.x,o.y,o.width,o.height);
    ctx.fillStyle="#ff4444";
    ctx.beginPath();
    ctx.moveTo(o.x+o.width/2,o.y);
    ctx.lineTo(o.x,o.y+20);
    ctx.lineTo(o.x+o.width,o.y+20);
    ctx.fill();
    ctx.fillStyle="#DC143C";
  });
  ctx.shadowBlur=0;

  drawParticles();
}

// ==== GAME OVER & AD ====
function gameOver(){
  gameState.gameRunning=false;
  document.getElementById("finalScore").textContent=Math.floor(gameState.score);
  document.getElementById("gameOver").style.display="block";
}

const adModal  = document.getElementById("adModal");
const adAudio  = document.getElementById("adAudio");
const rewardBtn= document.getElementById("rewardBtn");
const adFile   = "vid-20251127-233903_BeFYH0fz.mp3";

rewardBtn.onclick = () => {
  adAudio.src = adFile;
  adModal.style.display = "flex";
  adAudio.currentTime = 0;
  adAudio.play().catch(()=>{});
};

adAudio.onended = () => {
  gameState.lives = 3;
  gameState.gameRunning = true;
  document.getElementById("gameOver").style.display = "none";
  adModal.style.display = "none";
};

document.getElementById("restartBtn").onclick = () => location.reload();

gameLoop();
</script>
</body>
</html>
